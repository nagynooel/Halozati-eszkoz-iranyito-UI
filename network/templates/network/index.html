<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hálózati Eszköz Manager</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>
<body>

    <h1>Hálózati Eszköz Manager</h1>
    <div>
        <input type="text" id="ip-input" name="ip-input" placeholder="Enter Device IP Address" />
        <button type="submit" id="connect-button">Kapcsolódás</button>
    </div>

    <div id="alert-box" style="display: none;">
        <h3 id="alert-text">Sikeres csatlakozás</h3>
    </div>

    <button style="margin:10px" onclick="send_command('conf t')">Send</button>

    <div id="container">
        <div id="interface-list">
            <h2>General settings</h2>
            <ul id="general-settings" style="display: none;">
                <div id="interface-item" onclick="showGeneralSettings()">General Settings</div>
                <div id="interface-item" onclick="showVlanDatabase()">VLAN Database</div>
            </ul>
            <h2>Interfaces</h2>
            <ul id="interface-items">
                <!-- Interface items will be dynamically added here -->
            </ul>
        </div>
        <div id="settings">
            <h2>Settings</h2>
            <div id="interface-settings">
                <!-- Settings for the selected interface will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        const connectButton = document.getElementById('connect-button');
        const ipInput = document.getElementById('ip-input');
        const generalSettingsButtons = document.getElementById('general-settings');
        const interfaceItems = document.getElementById('interface-items');
        const interfaceSettings = document.getElementById('interface-settings');
    
        connectButton.addEventListener('click', function() {
            const ipAddress = ipInput.value;
    
            fetch("/connect/" + ipAddress)
            .then((response) => response.json())
            .then((json) => {
                const interfaces = Object.keys(json);
                console.log(interfaces);
    
                // Clear previous interface items
                interfaceItems.innerHTML = '';
    
                // Show general settings buttons when a device is connected
                generalSettingsButtons.style.display = 'block';
    
                // Populate the interface list
                interfaces.forEach(interface => {
                    const li = document.createElement('li');
                    li.textContent = interface;
                    li.className = 'interface-item';
                    li.onclick = () => showSettings(interface);
                    interfaceItems.appendChild(li);
                });
            });
        });
    
        function send_command(command_message) {
            fetch("/send_command/", {
                method: "POST",
                headers: {
                    "Content-type": "application/json; charset=UTF-8"
                },
                body: JSON.stringify({
                    command: command_message
                }),
            });
        }
    
        function showSettings(interface) {
            const settings = `
                <div class="setting"><strong>Interface:</strong> ${interface}</div>
                <div class="setting"><strong>Status:</strong> <button onclick="toggleStatus('${interface}')">Toggle On/Off</button></div>
                <div class="setting"><strong>IP Address:</strong> <input type="text" placeholder="Enter IP Address" /></div>
                <div class="setting"><strong>Switchport Mode:</strong>
                    <select id="switchport-mode" onchange="toggleVlanInput()">
                        <option value="access">Access</option>
                        <option value="trunk">Trunk</option>
                    </select>
                </div>
                <div class="setting" id="vlan-setting" style="display: none;">
                    <strong>VLAN ID:</strong> <input type="number" id="vlan-input" placeholder="Enter VLAN ID" />
                </div>
            `;
            interfaceSettings.innerHTML = settings;
        }
    
        function toggleVlanInput() {
            const modeSelect = document.getElementById('switchport-mode');
            const vlanSetting = document.getElementById('vlan-setting');
            if (modeSelect.value === 'access') {
                vlanSetting.style.display = 'block';
            } else {
                vlanSetting.style.display = 'none';
            }
        }
    
        function toggleStatus(interface) {
            alert(`Toggling status for ${interface}`);
        }
    
        function showGeneralSettings() {
            const settings = `
                <div class="setting"><strong>Hostname:</strong> 
                    <input type="text" id="hostname-input" placeholder="Enter new hostname" />
                    <button onclick="changeHostname()">Change Hostname</button>
                </div>
            `;
            interfaceSettings.innerHTML = settings;
        }
    
        function changeHostname() {
            const hostnameInput = document.getElementById('hostname-input');
            const newHostname = hostnameInput.value;
    
            // Logic to change the hostname
            fetch("/change_hostname/", {
                method: "POST",
                headers: {
                    "Content-type": "application/json; charset=UTF-8"
                },
                body: JSON.stringify({
                    hostname: newHostname
                }),
            }).then(response => {
                if (response.ok) {
                    sendAlert("Hostname changed successfully!", "green");
                } else {
                    sendAlert("Failed to change hostname.", "red");
                }
            });
        }
    
        function showVlanDatabase() {
            // Logic to fetch and display VLAN database
            fetch("/vlan_database/")
            .then(response => response.json())
            .then(data => {
                // Process and display VLAN data
                let vlanList = "<h3>VLAN Database</h3><ul>";
                data.forEach(vlan => {
                    vlanList += `<li>VLAN ID: ${vlan.id}, Name: ${vlan.name}</li>`;
                });
                vlanList += "</ul>";
                interfaceSettings.innerHTML = vlanList;
            });
        }
    
        function sendAlert(message, color) {
            document.getElementById("alert-text").innerHTML = message;
            document.getElementById("alert-text").style.color = color;
            document.getElementById("alert-box").style.display = "block";
        }
    </script>
    </body>
</html>